@model Biblio.Models.Borrowing
@using System.Globalization
@{
    ViewData["Title"] = "Borrowing Details";

    // (تحديد الـ classes زي ما بنعمل في الـ partial)
    string statusClass = "status-borrowed";
    string fineClass = "status-returned";
    string rowClass = "";

    if (Model.Status == BorrowingStatus.Overdue)
    {
        statusClass = "status-overdue";
        rowClass = "overdue-row";
    }
    else if (Model.Status == BorrowingStatus.Returned)
    {
        statusClass = "status-returned";
    }

    if (Model.FineAmount > 0)
    {
        fineClass = "status-overdue";
    }
}

<div id="borrowing-details-view" class="card shadow-sm p-3">

    <div class="row g-3 align-items-start">
        <div class="col-md-4 col-lg-3 text-center text-md-start">
            <img src="@(Model.Book?.CoverImageUrl ?? "/img/missing.png")"
                 alt="@Model.Book?.Title"
                 class="img-fluid rounded shadow-sm mb-3"
                 style="max-width:250px; height:auto; object-fit:cover;"
                 onerror="this.onerror=null; this.src='/img/missing.png';" />

            <div class="mt-2">
                <strong class="mb-3">Borrowed by:</strong>
                <div class="visitor-details-box">
                <a asp-controller="Visitors" asp-action="Details" asp-route-id="@Model.VisitorID" class="text-decoration-none">
                    <div class="fw-bold fs-5">@Model.Visitor?.Name</div>
                    <ul class="list-unstyled">
                    <li>
                    <i class="fas fa-envelope "></i>
			                    <span class="text-muted small">@Model.Visitor?.Email</span>
                    </li>
                    <li>
                    <i class="fas fa-phone "></i>
			            <span class="text-muted small">@Model.Visitor?.Phone</span>
					</li>
                    </ul>
@*                     <i class="fas fa-envelope "></i><div class="text-muted small">@Model.Visitor?.Email</div>         
                    <i class="fas fa-phone "></i><div class="text-muted small">@Model.Visitor?.Phone</div>    
 *@                </a>
                </div>
            </div>


        </div>

        @* Right column: rest of the data arranged cleanly *@
        <div class="col-md-8 col-lg-9">
            <div>
                <h2 class="fw-bold">@Model.Book?.Title</h2>
                <p class="text-muted">@Model.Book?.Author</p>
            </div>

            <div class="row">
                <div class="col-sm-6 mb-2 mt-4">
                    <ul class="list-unstyled">
                        <li class="m-3">
                            <strong>Borrow Date:</strong>
                            <span class="date-badge me-2">@Model.BorrowDate.ToShortDateString()</span>
                        </li>
                        <li class ="m-3">
                            <strong>Due Date:</strong>
                            <span class="status-badge @statusClass">@Model.DueDate.ToShortDateString()</span>
                        </li>
                        @if (Model.ReturnDate.HasValue)
                        {
                            <li class="m-3">
                                <strong>Return Date:</strong>
                                <span class="status-badge status-returned ms-2">@Model.ReturnDate.Value.ToShortDateString()</span>
                            </li>
                        }
                    </ul>
                </div>

                <div class="col-sm-6 mb-2 mt-4">
                    <ul class="list-unstyled">
                        <li class="m-3">
                            <strong>Status:</strong>
                            <span class="status-badge @statusClass me-2">@Model.Status.ToString()</span>
                        </li>
                        <li class="m-3">
                            <strong>Fine:</strong>
                            <span class="status-badge @fineClass ms-2">
                                @(Model.FineAmount > 0 ? Model.FineAmount.ToString("C", new CultureInfo("en-EG")) : "No Fine")
                            </span>
                        </li>

                    </ul>
                </div>

            </div>

        </div>
    </div>
</div>
<div class="justify-content-between align-items-center mt-3">

    <a asp-action="Index" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left"></i> Back to Lending
    </a>
</div>
